---
title: AOP
date: 2017-04-20 21:31:23
tags:
- Java
- Spring
- 编程范式
---

### 什么是AOP

AOP（Aspect-OrientedProgramming，面向方面编程），可以说是OOP（Object-Oriented Programing，面向对象编程）的补充和完善。OOP引入封装、继承和多态性等概念来建立一种对象层次结构，用以模拟公共行为的一个集合。当我们需要为分散的对象引入公共行为的时候，OOP则显得无能为力。也就是说，OOP允许你定义从上到下的关系，但并不适合定义从左到右的关系。例如日志功能。日志代码往往水平地散布在所有对象层次中，而与它所散布到的对象的核心功能毫无关系。对于其他类型的代码，如安全性、异常处理和透明的持续性也是如此。这种散布在各处的无关的代码被称为横切（cross-cutting）代码，在OOP设计中，它导致了大量代码的重复，而不利于各个模块的重用。
 
而AOP技术则恰恰相反，它利用一种称为“横切”的技术，剖解开封装的对象内部，并将那些影响了多个类的公共行为封装到一个可重用模块，并将其名为“Aspect”，即方面。所谓“方面”，简单地说，就是将那些与业务无关，却为业务模块所共同调用的逻辑或责任封装起来，便于减少系统的重复代码，降低模块间的耦合度，并有利于未来的可操作性和可维护性。AOP代表的是一个横向的关系，如果说“对象”是一个空心的圆柱体，其中封装的是对象的属性和行为；那么面向方面编程的方法，就仿佛一把利刃，将这些空心圆柱体剖开，以获得其内部的消息。而剖开的切面，也就是所谓的“方面”了。然后它又以巧夺天功的妙手将这些剖开的切面复原，不留痕迹。


### 要解决的问题

基于Java语言的web开发，本质是用面向对象的组织，面向过程的逻辑，来解决问题。

但仍会遇到一种麻烦，即假如一个流程分三个步骤，分别是X,A,Y，另一个流程的三个步骤是X,B,Y。写在程序里，两个方法体分别是XAY和XBY，显然，这出现了重复，违反了DRY原则。你可以把X和Y分别抽成一个方法，但至少还是要写一条语句来调用方法，xAy，xBy，重复依然存在。

如果采用模板方法的模式，在抽象父类方法体中声明x?y，其中?部分为抽象方法，由具体子类实现。但这就出现了继承，而且调用者只能调用父类声明的方法，耦合性太强，不灵活。
所以，我们常看到，只有那些本来就是调用者调用父类声明的方法的情况，比如表现层，或者本来就不用太灵活，比如只提供增删改查的持久层，才总出现抽象父类的身影。


具体Controller is-a 抽象Controller，具体Dao is-a 抽象Dao，这大家都能接受。
但除了在抽象Controller、抽象Dao中固定的步骤之外，我们就不需要点别的吗？
比如在某些Controller方法运行之前做点什么，在某些Dao方法运行之前之后做点什么？
而且最好能基于配置，基于约定，而不是都死乎乎硬编码到代码里。

举个简单的🌰，加入我们想要在Controller和Dao中加入打印日志的功能怎么办？依据现有的解决思路我们可能有以下方法

1. 为每个需要输出日志的类添加输出日志的代码。
2. 为Controller和Dao的父类添加日志输出代码。

第一种方法显然是最直接的方法，但是明显是在用面向过程的编程方法来处理面向对象的开发，而且它处理起来工作量大，极易出现疏漏的情况。

第二种情况可以轻松的完成任务，但是如果应用中的Controller和Dao不是继承自同一个父类，那么它修正起来的难度和工作量也是很大。从另一个角度考虑，Controller和Dao涉及到的都是业务层的处理，但是日志输出显示并不能归于业务处理的范畴。同时Controller和Dao中加入了日志的处理显然增加了它们对日志处理的耦合性，不宜于程序的拆分。

AOP面向切面编程的思想是引导开发者从另一个切面看待这些问题和工作。日志不管在何处它是属于日志系统这一角色，AOP可以允许你已统一的方式来处理你想要的这部分逻辑。

### 使用场景

- Authentication 权限
- Caching 缓存
- Context passing 内容传递
- Error handling 错误处理
- Lazy loading　懒加载
- Debugging　　调试
- logging, tracing, profiling and monitoring　记录跟踪　优化　校准
- Performance optimization　性能优化
- Persistence　　持久化
- Resource pooling　资源池
- Synchronization　同步
- Transactions 事务

### 参考资料
- [好书一起读(115)：重学Spring之面向切面](http://mp.weixin.qq.com/s?__biz=MzA4NTE1MDk5MA==&mid=2672797679&idx=1&sn=4c44e1a27b37cd30505f1f1eec88f51a&chksm=85675b8eb210d298295ed6a51fe16a632d83d732413564e88e508c66a1cebe77e89a6c0cb9fe#rd)
- [Spring AOP 实现原理](http://blog.csdn.net/moreevan/article/details/11977115/)